@using DanzFloor.Web.Models.Dominio
@using DanzFloor.Web.Models

@model Pedido

<!-- DESKTOP -->
<div class="table-responsive margintop40 hidden-xs" item-tabla-articulo>
    <table class="table table-checkout">
        <thead>
            <tr>
                <th></th>
                <th>ARTÍCULO</th>
                <th>PRECIO UNITARIO</th>
                <th>UNIDADES POR CAJA</th>
                <th>CANTIDAD</th>
                <th>TOTAL</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Articulos)
            {
                <tr>
                    <td><img src="@Archivo.ObtenerUrlArchivo(item.Articulo.Producto.Archivos, TipoEntidadConst.PRODUCTO, "Imagen Principal")"></td>
                    <td class="h5">@item.Articulo.Producto.Nombre</td>
                    <td class="td-checkout">$@((item.Precio / item.Articulo.CantidadUnidades).VistaPrecio())</td>
                    <td checkout-item-unidades class="item-quantity td-checkout">@item.Articulo.CantidadUnidades</td>
                    <td class="td-checkout"><span checkout-item-unidades>@item.Cantidad</span> cajas</td>
                    <td class="td-checkout">$@((item.Precio * item.Cantidad).VistaPrecio())</td>
                    <td>
                        <a remover-articulo="@item.Articulo.Id" remover-cantidad="@item.Cantidad"><i class="pe-7s-close-circle"></i></a>
                        <a editar-articulo="@item.Articulo.Id"><i class="pe-7s-note"></i></a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- MOBILE -->
<div class="visible-xs item-tabla-articulo margintop30">
    <hr class="" />
    @foreach (var item in Model.Articulos)
    {
        <div class="row">
            <div class="col-xs-4">
                <img src="@Archivo.ObtenerUrlArchivo(item.Articulo.Producto.Archivos, TipoEntidadConst.PRODUCTO, "Imagen Principal")" alt="" class="img-responsive" />
            </div>
            <div class="col-xs-8 ita-data">
                <h5>@item.Articulo.Producto.Nombre</h5>
                <p class="cuenta general-title"><span class="black">@item.Cantidad caja/s</span> x $@item.Precio x @item.Articulo.CantidadUnidades</p>
                <div class="flex-items">
                    <div class="ita-actions">
                        <a remover-articulo="@item.Articulo.Id" remover-cantidad="@item.Cantidad"><i class="pe-7s-close-circle"></i></a>
                        <a editar-articulo="@item.Articulo.Id"><i class="pe-7s-note"></i></a>
                    </div>
                    <p class="precio-xs font20 brandonMd pull-right"> $@(item.Precio * item.Cantidad)</p>
                </div>

            </div>
        </div>
        <hr />
    }
</div>


<script type="text/javascript">
    $('[remover-articulo]').click(function () {
        var thisClick = $(this);
        var articuloId = thisClick.attr('remover-articulo');
        var cantidad = thisClick.attr('remover-cantidad');
        var cantidadRestar = parseInt(cantidad) * -1;

        $.ajax({
            dataType: 'json',
            type: 'GET',
            url: core + '/pedido/RemoverArticuloPedidoInicial/?articuloId=' + articuloId,
            success: function (result) {
                location.href = location.origin + location.pathname;
            },
            error: function (ex) {
                console.log(ex)
            },
        });
    });
</script>
<script type="text/javascript">
    $(document).ready(function () {
        var articuloId;

        $('[editar-articulo]').click(function () {
            articuloId = $(this).attr('editar-articulo');

            $.ajax({
                dataType: 'json',
                type: 'GET',
                url: core + '/Articulo/ObtenerPorCliente/?id=' + articuloId + "&clienteId=" + clienteId,
                success: function (data) {
                    var articulo = data.Mensaje;
                    $('[modificar-articulo-nombre]').html(articulo.Nombre);
                    $('[modificar-articulo-precio-unitario]').html('$' + articulo.PrecioUnitario);
                    $('[modificar-articulo-cantidad-unidades]').html(articulo.CantidadUnidades);
                    $('[modificar-articulo-precio]').html('$' + articulo.Precio);
                    $('[modificar-imagen]').attr('src', articulo.ImagenPrincipal);

                    $('input[type="radio"]').each(function () {
                        $(this).removeAttr('checked');
                    });
                    $('[cantidad-uno]').attr('checked', 'checked');
                    $('[modificar-cantidad]').val('');
                    $('#modificarCart').modal('show');
                },
                error: function (ex) {
                    console.log(ex)
                },
            });
        });

        $('[modificar-cantidad-valor]').click(function () {
            Editar($(this).attr('modificar-cantidad-valor'), articuloId);
        });

        $('[modificar-articulo]').click(function () {
            Editar($('[modificar-cantidad]').val(), articuloId);
        });

        $('[modificar-articulo-mobile]').click(function () {
            Editar($('[modificar-cantidad-mobile]').val(), articuloId);
        });
    });

    var Editar = function (cantidad, articuloId) {
        $.ajax({
            dataType: 'json',
            type: 'GET',
            url: core + '/pedido/ModificarArticuloCantidadPedidoInicial/?articuloId=' + articuloId + "&cantidad=" + cantidad,
            success: function (result) {
                location.href = location.origin + location.pathname;
            },
            error: function (ex) {
                console.log(ex)
            },
        });
    }
</script>
